{"version":3,"file":"0.925610b8febf1f15d0df.hot-update.js","sources":["webpack:///src/server.js","webpack:///external \"bluebird\""],"sourcesContent":["import App from './App';\nimport React from 'react';\nimport { StaticRouter } from 'react-router-dom';\nimport express from 'express';\nimport { renderToString } from 'react-dom/server';\nvar router = express.Router();\nvar ldap = require('ldapjs');\nvar promise = require('bluebird');\n\nasync function ldapSearch() {\n  \n  //ldap.Attribute.settings.guid_format = ldap.GUID_FORMAT_B;\n  var client = ldap.createClient({\n    url: 'ldap://ldap.cnam.fr/cn=cldap,ou=services,dc=cnam,dc=fr',\n    timeout: 5000,\n    connectTimeout: 10000\n});\nvar opts = {\nfilter: '(&(uid=lelongj))',\nscope: 'sub',\nattributes: ['uid','givenname']\n};\n\nconsole.log('--- going to try to connect user ---');\n\ntry {\n  client.bind('', '', function (error) {\n      \n    if(error){\n      console.log('ERREUR');\n      console.log(error.message);\n          client.unbind(function(error) {if(error){console.log(error.message);} else{console.log('client disconnected');}});\n      } else {\n          console.log('connected');\n          client.search('ou=people,o=personnel,dc=cnam,dc=fr', opts, function(error, search) {\n              console.log('Searching.....');\n\n              search.on('searchEntry', function(entry) {\n                if(entry.object){\n                      console.log('entry: %j ' + JSON.stringify(entry.object));\n                  }\n                  return entry.object;\n              });\n\n              search.on('error', function(error) {\n                  console.error('error: ' + error.message);\n              });\n\n              client.unbind(function(error) {if(error){console.log(error.message);} else{console.log('client disconnected');}});\n          });\n      }\n  });\n} catch(error){\nconsole.log(error);\n  client.unbind(function(error) {if(error){console.log(error.message);} else{console.log('client disconnected');}});\n  \n}\n}\n\nrouter.get('/',async  function(req, res, next) {\n  //res.send('respond with a resource');\n  //const users = [{username: 'lelongj',id: 1}, {username: 'dupontd',id: 2}];\n  //return res.json(users);\n  return res.json(await ldapSearch());\n\n\n});\n\nconst assets = require(process.env.RAZZLE_ASSETS_MANIFEST);\n\nconst server = express();\n\nserver.use('/users', router);\n\nserver\n  .disable('x-powered-by')\n  .use(express.static(process.env.RAZZLE_PUBLIC_DIR))\n  .get('/*', (req, res) => {\n    const context = {};\n    const markup = renderToString(\n      <StaticRouter context={context} location={req.url}>\n        <App />\n      </StaticRouter>\n    );\n\n    if (context.url) {\n      res.redirect(context.url);\n    } else {\n      res.status(200).send(\n        `<!doctype html>\n    <html lang=\"\">\n    <head>\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n        <meta charSet='utf-8' />\n        <title>Welcome to Razzle</title>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        ${assets.client.css\n          ? `<link rel=\"stylesheet\" href=\"${assets.client.css}\">`\n          : ''}\n        ${process.env.NODE_ENV === 'production'\n          ? `<script src=\"${assets.client.js}\" defer></script>`\n          : `<script src=\"${assets.client.js}\" defer crossorigin></script>`}\n    </head>\n    <body>\n        <div id=\"root\">${markup}</div>\n    </body>\n</html>`\n      );\n    }\n  });\n\nexport default server;\n\n\n\n// WEBPACK FOOTER //\n// src/server.js","module.exports = require(\"bluebird\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bluebird\"\n// module id = bluebird\n// module chunks = 0"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AAHA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAhDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;;;;;AATA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAmDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AACA;AAIA;AACA;AACA;AACA;AAoBA;AACA;AACA;AACA;;;;;;;AC/GA;;;;A","sourceRoot":""}